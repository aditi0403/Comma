<%- include('partials/header', { title: "Profile", user }) %>
<link rel="stylesheet" href="/styles/bento.css">

<div class="bento-outer">
  <!-- Profile Row -->
  <div class="bento-box profile-row">
    <!-- Profile Info -->
   <div class="profile-bento-left">
    <div class="profile-info">
    <div class="profile-avatar-box">
      <img src="<%= user.profilePicture ? user.profilePicture.url : '/images/default-profile.png' %>" alt="Avatar" class="profile-avatar">
    </div>
    <div class="profile-details-box">
      <div class="bento-title"><%= user.username %></div>
      <div class="profile-meta"><%= user.pronouns || '' %></div>
      <p class="profile-meta"><%= user.bio || 'No bio available' %></p>
    </div>
</div>

  </div>


    
    <div class="profile-bento-right">
      <div class="bento-box">
        <a href="/user/edit" class="bento-btn">
          <i class="fas fa-edit"></i> Edit Profile
        </a>
        <form action="/user/delete" method="POST" style="margin: 0;">
          <button type="submit" class="bento-btn delete-btn" onclick="return confirm('Are you sure you want to delete your account?')">
            <i class="fas fa-trash"></i> Delete Account
          </button>
        </form>
        <form action="/auth/logout" method="POST" style="margin: 0;">
          <button type="submit" class="bento-btn">
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </form>
      </div>
    </div>
  </div>

  <div class="bento-box posts-header">
    <h3 class="bento-title">Your Posts - <%= posts?.length || 0 %></h3>
  </div>

  <div class="posts-grid">
    <% if (posts && posts.length > 0) { %>
      <% posts.forEach(post => { %>
        <div class="bento-box post-card">
          <a href="/posts/<%= post._id %>" class="post-link">
            <% if (post.images && post.images.length > 0) { %>
              <img src="<%= post.images[0].url %>" alt="Post Image" class="post-card-image">
            <% } %>
            <div class="post-card-title"><%= post.title %></div>
            <div class="post-card-meta"><%= post.createdAt.toDateString() %></div>
            <div class="post-card-content">
              <%= post.content ? post.content.substring(0, 120) + (post.content.length > 120 ? '...' : '') : 'No content available' %>
            </div>
          </a>
        </div>
      <% }) %>
    <% } else { %>
      <div style="text-align: center; padding: 3rem;">No posts yet.</div>
    <% } %>
  </div>
</div>


<%- include('partials/footer') %>
