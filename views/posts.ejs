<%- include('partials/header', { title, user: user }) -%>

<style>
  body {
    color: white;
  }

  .bento-grid {
    display: grid;
    grid-template-columns: repeat(5, minmax(80px, 1fr));
    grid-auto-rows: minmax(150px, auto);
    grid-auto-flow: dense;
    gap: 1.25rem;
    padding: 0;
  }

  @media (max-width: 575px) {
    .bento-grid {
      grid-template-columns: 1fr;
      grid-auto-rows: minmax(120px, auto);
    }
    .masonry-item {
      grid-column: span 1 !important;
      grid-row: span 1 !important;
    }
  }

  @media (min-width: 576px) and (max-width: 991px) {
    .bento-grid {
      grid-template-columns: repeat(2, 1fr);
      grid-auto-rows: minmax(160px, auto);
    }
    .span-3-of-5 {
        grid-column: span 2 !important;
    }
    .span-1-of-5 {
        grid-column: span 1 !important;
    }
    .span-2-of-5 {
        grid-column: span 2 !important;
    }
    .item-clamp-more p { -webkit-line-clamp: 8; }
    .item-clamp-even-more p { -webkit-line-clamp: 10; }
  }

  @media (min-width: 992px) {
    .bento-grid {
      grid-template-columns: repeat(5, minmax(80px, 1fr));
      grid-auto-rows: minmax(180px, auto);
    }
  }

  .masonry-item {
    padding: 1rem;
    border-radius: 1.25rem;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    transition: transform 0.2s;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .masonry-item:hover {
    transform: scale(1.01);
  }

  .masonry-title {
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 0.4rem;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    padding: 0 0.25rem;
    flex-shrink: 0;
  }

  .masonry-meta {
    font-size: 0.8rem;
    opacity: 0.7;
    margin-top: 0.5rem;
    flex-shrink: 0;
  }

  .bento-btn {
    background-color: white;
    color: black;
    border: none;
    padding: 0.4rem 0.8rem;
    border-radius: 0.8rem;
    text-decoration: none;
    display: inline-block;
    margin-top: 0.6rem;
    align-self: flex-start; 
    flex-shrink: 0;
  }

  .masonry-item img {
    max-height: 150px;
    height: 35%;
    min-height: 60px;
    width: 100%;
    object-fit: cover;
    border-radius: 0.8rem;
    margin-bottom: 0.75rem;
    flex-shrink: 0;
    align-self: center;
  }

  .masonry-item p {
    word-wrap: break-word;
    overflow-wrap: break-word;
    word-break: break-word;
    white-space: normal;
    flex-grow: 1;
    flex-shrink: 1;
    min-height: 2em;
    max-height: 8em;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 6;
    -webkit-box-orient: vertical;
    text-overflow: ellipsis;
    margin-bottom: 0.4rem;
    line-height: 1.3em;
    box-sizing: border-box;
  }

  .bg-1 { background: linear-gradient(135deg, #434343, #000000); }
  .bg-2 { background: linear-gradient(135deg, #2c3e50, #34495e); }
  .bg-3 { background: linear-gradient(135deg, #2c1810, #8b4513); }
  .bg-4 { background: linear-gradient(135deg, #1e3c72, #2a5298); }
  .bg-5 { background: linear-gradient(135deg, #134e5e, #71b280); }

  .span-3-of-5 { grid-column: span 3; }
  .span-1-of-5 { grid-column: span 1; }
  .span-2-of-5 { grid-column: span 2; }

  .item-clamp-more p { -webkit-line-clamp: 8; }
  .item-clamp-even-more p { -webkit-line-clamp: 12; }
</style>

<div class="container-fluid px-4 py-3">
  <h1 class="text-center mb-3 text-black">Posts</h1>

  <% if (posts?.length > 0) { %>
    <div class="bento-grid">
      <% posts.forEach((post, index) => { %>
        <%
          let itemClass = '';
          let clampClass = '';

          const rowType = Math.floor(index / 3) % 2;
          const positionInRow = index % 3;

          if (rowType === 0) {
            if (positionInRow === 0) {
              itemClass = 'span-3-of-5';
              clampClass = 'item-clamp-even-more';
            } else {
              itemClass = 'span-1-of-5';
              clampClass = 'item-clamp-more';
            }
          } else {
            if (positionInRow === 2) {
              itemClass = 'span-3-of-5';
              clampClass = 'item-clamp-even-more';
            } else {
              itemClass = 'span-1-of-5';
              clampClass = 'item-clamp-more';
            }
          }
        %>
        <div class="masonry-item bg-<%= (index % 5) + 1 %> <%= itemClass %> <%= clampClass %>">
          <% if (post?.images?.length > 0) { %>
            <img src="<%= post.images[0].url %>" alt="Post Image">
          <% } %>
          <div class="masonry-title"><%= post.title %></div>
          <p><%= post.content %></p>
          <div class="masonry-meta">
            <p>By <%= post.author.username %></p>
            <p><%= post.createdAt.toDateString() %></p>
          </div>
          <a href="/posts/<%= post._id %>" class="bento-btn">Read More</a>
        </div>
      <% }) %>
    </div>
  <% } else { %>
    <div class="text-center mt-5">
      <p class="lead">No posts yet. Be the first to create one!</p>
      <a href="/posts/add" class="bento-btn">Create New Post</a>
    </div>
  <% } %>
</div>

<%- include('partials/footer') -%>